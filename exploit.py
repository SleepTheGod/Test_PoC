import websocket
import json
import time

YOUR_BTC_ADDRESS = "3EfHTAgiL2LchH9uvp3wXsRfSqrciNTArr"

def on_open(ws):
    """
    Called when the websocket is opened.
    """
    ws.send(json.dumps({"op": "addr_sub", "addr": YOUR_BTC_ADDRESS}))

def on_message(ws, message):
    """
    Called when a message is received from the websocket.
    """
    response = json.loads(message)
    if response.get('op') == 'utx':
        for tx in response.get('x', {}).get('out', []):
            if tx.get('addr') == YOUR_BTC_ADDRESS:
                amount = tx['value'] / 100000000
                print(f"Payment received: {amount} BTC")

def on_error(ws, error):
    """
    Called when an error occurs with the websocket.
    """
    print(f"An error occurred: {error}")

def on_close(ws, close_status_code, close_msg):
    """
    Called when the websocket is closed.
    """
    print(f"Websocket closed with status code {close_status_code} and message {close_msg}")

if __name__ == "__main__":
    websocket.enableTrace(True)
    ws = websocket.WebSocketApp("wss://ws.blockchain.info/inv",
                                on_open=on_open,
                                on_message=on_message,
                                on_error=on_error,
                                on_close=on_close)
    ws.run_forever()
